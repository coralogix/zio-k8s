---
id: crd_howto
title:  "How to work with custom resources"
---

The official _Kubernetes documentation_ [describes an example](https://kubernetes.io/docs/tasks/extend-kubernetes/custom-resources/custom-resource-definitions/) of creating a `CronTab` resource. On this page will take the same example and access the custom resource with `zio-k8s`.

## Custom resource definition

Start with an empty `sbt` project. The first step is to create the _custom resource definition_ as a standard Kubernetes CRD YAML. We can take the example from the above linked documentation page and put it in a subfolder, for example `crds/crontab.yaml`:

```yaml
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  # name must match the spec fields below, and be in the form: <plural>.<group>
  name: crontabs.stable.example.com
spec:
  # group name to use for REST API: /apis/<group>/<version>
  group: stable.example.com
  # list of versions supported by this CustomResourceDefinition
  versions:
    - name: v1
      # Each version can be enabled/disabled by Served flag.
      served: true
      # One and only one version must be marked as the storage version.
      storage: true
      schema:
        openAPIV3Schema:
          type: object
          properties:
            spec:
              type: object
              properties:
                cronSpec:
                  type: string
                image:
                  type: string
                replicas:
                  type: integer
  # either Namespaced or Cluster
  scope: Namespaced
  names:
    # plural name to be used in the URL: /apis/<group>/<version>/<plural>
    plural: crontabs
    # singular name to be used as an alias on the CLI and for display
    singular: crontab
    # kind is normally the CamelCased singular type. Your resource manifests use this.
    kind: CronTab
    # shortNames allow shorter string to match your resource on the CLI
    shortNames:
    - ct
```

This can be applied to a _Kubernetes cluster_ with `kubectl`:

```
kubectl apply -f crds/crontab.yaml
```

or with Scala code using the `CustomResourceDefinitions` resource provided by `zio-k8s-client`. The [operator library provides a helper function](../operator/registration.md) to register custom resoure definitions on startup.

## Code generator
The next step is to add `zio-k8s-crd` to the list of _sbt plugins_, in `project/plugins.sbt`:

```scala mdoc:passthrough

println(s"""```scala""")
if (zio.k8s.BuildInfo.isSnapshot)
  println(s"""resolvers += Resolver.sonatypeRepo("snapshots")""")
println(s"""addSbtPlugin("com.coralogix" %% "zio-k8s-crd" % "${zio.k8s.BuildInfo.version}"""")
println(s"""```""")

```

and in the `build.sbt` enable code generation from the `crontab.yml` file:

```scala
externalCustomResourceDefinitions := Seq(
  file("crds/crontab.yaml"),
)

enablePlugins(K8sCustomResourceCodegenPlugin)
```

## Using the generated client

The sbt plugin generates code that has exactly the same structure as the built-in _Kubernetes resources_. There will be a client module with live and test layers for each custom resource.

```scala
import com.coralogix.zio.k8s.client.com.example.stable.v1.crontabs

crontabs.get("ct1", K8sNamespace.default)
```

The models for custom resources are generated by [Guardrail](https://guardrail.dev/), so everything that guardrail supports can be used in the OpenAPI specification.
